"use strict";var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _dotenv = _interopRequireDefault(require("dotenv"));
var _path = _interopRequireDefault(require("path"));








var _config = _interopRequireDefault(require("../app/config"));


require("../app/config/db");
var http = _interopRequireWildcard(require("http"));

require("../app/models/restaurant");













var _app = _interopRequireDefault(require("../app"));





var _restaurant2 = require("../app/services/restaurant");process.env.NODE_ENV = 'test';var bluebird = require('bluebird'); // dotenv.config({ path: path.resolve('/Users/krish/workshops/mindtree-301-node/services/restaurant/test.env')});
// console.log('path is ', path.resolve('/Users/krish/workshops/mindtree-301-node/services/restaurant/test.env'))
// process.env.MONGO_URL="mongodb://localhost/mocha-test"
// process.env.MONGO_URL="mongodb://localhost/mocha-test"
console.log('***config', _config["default"]);var mongoose = require("mongoose");var Restaurant = mongoose.model("Restaurant"); //Require the dev-dependencies
var chai = require('chai');var chaiHttp = require('chai-http');var sinon = require('sinon');var sinonTest = require('sinon-test');var test = sinonTest(sinon);var should = chai.should();var expect = chai.expect;var supertest = require('supertest'); // const apptest = supertest(http.createServer(app.callback()));
chai.use(chaiHttp); //Our parent block
describe('Restaurant', function () {
  beforeEach(function (done) {//Before each test we empty the database
    Restaurant.remove({}, function (err) {
      done();
    });
  });
  /*
        * Test the /GET route
        */
  describe('/GET /restaurants', function () {
    it('it should GET all the Restaurants', function (done) {
      chai.request(_app["default"]).
      get('/restaurants').
      end(function (err, res) {
        res.should.have.status(200);
        res.body.should.be.a('array');
        res.body.length.should.be.eql(0);
        done();
      });
    });
  });




  describe('/POST /restaurants', function () {
    it('it should Create a restaurant', function (done) {
      var restaurant = {
        "name": "TEST-123",
        "location": {
          "type": "Point",
          "coordinates": [12.9716, 77.5946] },

        "city": "Bangalore",
        "cuisine": ["veg"],
        "budget": 250,
        "rating": 4.6,
        "menu": [{ "title": "Meal", "price": 250 }] };


      chai.request(_app["default"]).
      post('/restaurants').
      send(restaurant).
      end(function (err, res) {
        res.should.have.status(200);
        res.body.should.be.a('object');

        res.body.should.have.property('name');
        res.body.should.have.property('_id');
        res.body.should.have.property('name').eql('TEST-123');
        res.body.should.have.property('budget').eql(250);


        done();
      });
    });

  });



  describe('Test model ', function () {
    it('should be invalid if required prorperties are empty', function (done) {
      // var restaurant = new Restaurant( {
      //     location: {
      //         type: 'Point',
      //         coordinates: []
      //     }
      // }
      // );

      var restaurant = new Restaurant();

      restaurant.validate(function (err) {
        //err.errors.propertyname

        // expect(err).to.be.null;
        expect(err.errors).to.exist; // property name is not working
        done();
      });
    });


    it('should call back with true when repost exists', test(function (done) {
      var responseObject = { name: 'foo' };
      this.stub(Restaurant, 'findOne').yields(null, responseObject);


      Restaurant.findOne({}, function (err, result) {
        console.log(result);
        expect(result).to.have.property('name');

        expect(result.name).to.equal('foo');



        done();
      });
    }));



    it('should call mock test', function (done) {
      var responseObject = { name: 'foo' };


      var findOneStub = sinon.stub(Restaurant, "findOne").yields(null, responseObject);

      Restaurant.findOne({}, function (err, result) {
        console.log(result);
        expect(result).to.have.property('name');

        expect(result.name).to.equal('foo');

        // to release the stuff
        findOneStub.restore();

        done();
      });
    });


    it('should call service with getRestaurant with id', function (done) {
      var responseObject = { id: '12345', name: 'foo' };


      var findByIdStub = sinon.stub(Restaurant, "findById").
      usingPromise(bluebird.Promise).
      resolves(responseObject);
      (0, _restaurant2.getRestaurant)('12345').
      then(function (result) {
        expect(result).to.have.property('name');
        expect(result.name).to.equal('foo');
        expect(result.id).to.equal('12345');

        result.id.should.equal('12345');


        // to release the stuff
        findByIdStub.restore();

        done();
      });

    });



  });




});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXN0cy9yZXN0YXVyYW50LnNwZWMuanMiXSwibmFtZXMiOlsicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiYmx1ZWJpcmQiLCJyZXF1aXJlIiwiY29uc29sZSIsImxvZyIsImNvbmZpZyIsIm1vbmdvb3NlIiwiUmVzdGF1cmFudCIsIm1vZGVsIiwiY2hhaSIsImNoYWlIdHRwIiwic2lub24iLCJzaW5vblRlc3QiLCJ0ZXN0Iiwic2hvdWxkIiwiZXhwZWN0Iiwic3VwZXJ0ZXN0IiwidXNlIiwiZGVzY3JpYmUiLCJiZWZvcmVFYWNoIiwiZG9uZSIsInJlbW92ZSIsImVyciIsIml0IiwicmVxdWVzdCIsImFwcCIsImdldCIsImVuZCIsInJlcyIsImhhdmUiLCJzdGF0dXMiLCJib2R5IiwiYmUiLCJhIiwibGVuZ3RoIiwiZXFsIiwicmVzdGF1cmFudCIsInBvc3QiLCJzZW5kIiwicHJvcGVydHkiLCJ2YWxpZGF0ZSIsImVycm9ycyIsInRvIiwiZXhpc3QiLCJyZXNwb25zZU9iamVjdCIsIm5hbWUiLCJzdHViIiwieWllbGRzIiwiZmluZE9uZSIsInJlc3VsdCIsImVxdWFsIiwiZmluZE9uZVN0dWIiLCJyZXN0b3JlIiwiaWQiLCJmaW5kQnlJZFN0dWIiLCJ1c2luZ1Byb21pc2UiLCJQcm9taXNlIiwicmVzb2x2ZXMiLCJ0aGVuIl0sIm1hcHBpbmdzIjoiO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FBU0E7OztBQUdBO0FBQ0E7O0FBRUE7Ozs7Ozs7Ozs7Ozs7O0FBY0E7Ozs7OztBQU1BLHlEQXJDQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFFBQVosR0FBdUIsTUFBdkIsQ0FHQSxJQUFNQyxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxVQUFELENBQXhCLEMsQ0FDQTtBQUVBO0FBRUE7QUFFQTtBQUVBQyxPQUFPLENBQUNDLEdBQVIsQ0FBWSxXQUFaLEVBQXlCQyxrQkFBekIsRUFPQSxJQUFJQyxRQUFRLEdBQUdKLE9BQU8sQ0FBQyxVQUFELENBQXRCLENB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IGZyb20gJ2RvdGVudic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmNvbnN0IGJsdWViaXJkID0gcmVxdWlyZSgnYmx1ZWJpcmQnKTtcbi8vIGRvdGVudi5jb25maWcoeyBwYXRoOiBwYXRoLnJlc29sdmUoJy9Vc2Vycy9rcmlzaC93b3Jrc2hvcHMvbWluZHRyZWUtMzAxLW5vZGUvc2VydmljZXMvcmVzdGF1cmFudC90ZXN0LmVudicpfSk7XG5cbi8vIGNvbnNvbGUubG9nKCdwYXRoIGlzICcsIHBhdGgucmVzb2x2ZSgnL1VzZXJzL2tyaXNoL3dvcmtzaG9wcy9taW5kdHJlZS0zMDEtbm9kZS9zZXJ2aWNlcy9yZXN0YXVyYW50L3Rlc3QuZW52JykpXG5cbi8vIHByb2Nlc3MuZW52Lk1PTkdPX1VSTD1cIm1vbmdvZGI6Ly9sb2NhbGhvc3QvbW9jaGEtdGVzdFwiXG5cbi8vIHByb2Nlc3MuZW52Lk1PTkdPX1VSTD1cIm1vbmdvZGI6Ly9sb2NhbGhvc3QvbW9jaGEtdGVzdFwiXG5pbXBvcnQgY29uZmlnIGZyb20gJy4uL2FwcC9jb25maWcnO1xuY29uc29sZS5sb2coJyoqKmNvbmZpZycsIGNvbmZpZyk7XG5cbmltcG9ydCAnLi4vYXBwL2NvbmZpZy9kYic7XG5pbXBvcnQgKiBhcyBodHRwIGZyb20gJ2h0dHAnO1xuXG5pbXBvcnQgJy4uL2FwcC9tb2RlbHMvcmVzdGF1cmFudCc7XG5cbmxldCBtb25nb29zZSA9IHJlcXVpcmUoXCJtb25nb29zZVwiKTtcblxubGV0IFJlc3RhdXJhbnQgPSBtb25nb29zZS5tb2RlbChcIlJlc3RhdXJhbnRcIik7XG5cbi8vUmVxdWlyZSB0aGUgZGV2LWRlcGVuZGVuY2llc1xubGV0IGNoYWkgPSByZXF1aXJlKCdjaGFpJyk7XG5sZXQgY2hhaUh0dHAgPSByZXF1aXJlKCdjaGFpLWh0dHAnKTtcbnZhciBzaW5vbiA9IHJlcXVpcmUoJ3Npbm9uJyk7XG52YXIgc2lub25UZXN0ID0gcmVxdWlyZSgnc2lub24tdGVzdCcpO1xudmFyIHRlc3QgPSBzaW5vblRlc3Qoc2lub24pO1xuXG5cbmltcG9ydCBhcHAgZnJvbSAnLi4vYXBwJztcblxubGV0IHNob3VsZCA9IGNoYWkuc2hvdWxkKCk7XG5jb25zdCBleHBlY3QgPSBjaGFpLmV4cGVjdDtcbmNvbnN0IHN1cGVydGVzdCA9IHJlcXVpcmUoJ3N1cGVydGVzdCcpO1xuXG5pbXBvcnQge2dldFJlc3RhdXJhbnR9IGZyb20gJy4uL2FwcC9zZXJ2aWNlcy9yZXN0YXVyYW50JztcblxuLy8gY29uc3QgYXBwdGVzdCA9IHN1cGVydGVzdChodHRwLmNyZWF0ZVNlcnZlcihhcHAuY2FsbGJhY2soKSkpO1xuXG5cbmNoYWkudXNlKGNoYWlIdHRwKTtcbi8vT3VyIHBhcmVudCBibG9ja1xuZGVzY3JpYmUoJ1Jlc3RhdXJhbnQnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoZG9uZSkgPT4geyAvL0JlZm9yZSBlYWNoIHRlc3Qgd2UgZW1wdHkgdGhlIGRhdGFiYXNlXG4gICAgICAgIFJlc3RhdXJhbnQucmVtb3ZlKHt9LCAoZXJyKSA9PiB7IFxuICAgICAgICAgICBkb25lKCk7ICAgICAgICAgXG4gICAgICAgIH0pOyAgICAgXG4gICAgfSk7XG4vKlxuICAqIFRlc3QgdGhlIC9HRVQgcm91dGVcbiAgKi9cbiAgZGVzY3JpYmUoJy9HRVQgL3Jlc3RhdXJhbnRzJywgKCkgPT4ge1xuICAgICAgaXQoJ2l0IHNob3VsZCBHRVQgYWxsIHRoZSBSZXN0YXVyYW50cycsIChkb25lKSA9PiB7XG4gICAgICAgIGNoYWkucmVxdWVzdChhcHApXG4gICAgICAgICAgICAuZ2V0KCcvcmVzdGF1cmFudHMnKVxuICAgICAgICAgICAgLmVuZCgoZXJyLCByZXMpID0+IHtcbiAgICAgICAgICAgICAgICByZXMuc2hvdWxkLmhhdmUuc3RhdHVzKDIwMCk7XG4gICAgICAgICAgICAgICAgcmVzLmJvZHkuc2hvdWxkLmJlLmEoJ2FycmF5Jyk7XG4gICAgICAgICAgICAgICAgcmVzLmJvZHkubGVuZ3RoLnNob3VsZC5iZS5lcWwoMCk7XG4gICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgfSk7XG4gIH0pO1xuXG5cblxuXG4gIGRlc2NyaWJlKCcvUE9TVCAvcmVzdGF1cmFudHMnLCAoKSA9PiB7XG4gICAgaXQoJ2l0IHNob3VsZCBDcmVhdGUgYSByZXN0YXVyYW50JywgKGRvbmUpID0+IHtcbiAgICAgIGxldCByZXN0YXVyYW50ID0ge1xuICAgICAgICBcIm5hbWVcIjogXCJURVNULTEyM1wiLFxuICAgICAgICBcImxvY2F0aW9uXCI6IHtcbiAgICAgICAgICAgIFwidHlwZVwiOiBcIlBvaW50XCIsXG4gICAgICAgICAgICBcImNvb3JkaW5hdGVzXCI6IFsxMi45NzE2LCA3Ny41OTQ2XVxuICAgICAgICB9LFxuICAgICAgICBcImNpdHlcIjogXCJCYW5nYWxvcmVcIixcbiAgICAgICAgXCJjdWlzaW5lXCI6IFtcInZlZ1wiXSxcbiAgICAgICAgXCJidWRnZXRcIjogMjUwLFxuICAgICAgICBcInJhdGluZ1wiOiA0LjYsXG4gICAgICAgIFwibWVudVwiOiBbIHtcInRpdGxlXCI6IFwiTWVhbFwiLCBcInByaWNlXCI6IDI1MCB9IF1cbiAgICB9XG5cbiAgICAgIGNoYWkucmVxdWVzdChhcHApXG4gICAgICAgICAgLnBvc3QoJy9yZXN0YXVyYW50cycpXG4gICAgICAgICAgLnNlbmQocmVzdGF1cmFudClcbiAgICAgICAgICAuZW5kKChlcnIsIHJlcykgPT4ge1xuICAgICAgICAgICAgICByZXMuc2hvdWxkLmhhdmUuc3RhdHVzKDIwMCk7XG4gICAgICAgICAgICAgIHJlcy5ib2R5LnNob3VsZC5iZS5hKCdvYmplY3QnKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIHJlcy5ib2R5LnNob3VsZC5oYXZlLnByb3BlcnR5KCduYW1lJyk7XG4gICAgICAgICAgICAgIHJlcy5ib2R5LnNob3VsZC5oYXZlLnByb3BlcnR5KCdfaWQnKTtcbiAgICAgICAgICAgICAgIHJlcy5ib2R5LnNob3VsZC5oYXZlLnByb3BlcnR5KCduYW1lJykuZXFsKCdURVNULTEyMycpO1xuICAgICAgICAgICAgICByZXMuYm9keS5zaG91bGQuaGF2ZS5wcm9wZXJ0eSgnYnVkZ2V0JykuZXFsKDI1MCk7XG4gICAgICAgICAgICAgIFxuXG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgfSk7XG4gICAgfSk7XG5cbn0pO1xuXG5cblxuZGVzY3JpYmUoJ1Rlc3QgbW9kZWwgJywgZnVuY3Rpb24oKSB7XG4gICAgaXQoJ3Nob3VsZCBiZSBpbnZhbGlkIGlmIHJlcXVpcmVkIHByb3JwZXJ0aWVzIGFyZSBlbXB0eScsIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgLy8gdmFyIHJlc3RhdXJhbnQgPSBuZXcgUmVzdGF1cmFudCgge1xuICAgICAgICAvLyAgICAgbG9jYXRpb246IHtcbiAgICAgICAgLy8gICAgICAgICB0eXBlOiAnUG9pbnQnLFxuICAgICAgICAvLyAgICAgICAgIGNvb3JkaW5hdGVzOiBbXVxuICAgICAgICAvLyAgICAgfVxuICAgICAgICAvLyB9XG4gICAgICAgIC8vICk7XG5cbiAgICAgICAgdmFyIHJlc3RhdXJhbnQgPSBuZXcgUmVzdGF1cmFudCgpO1xuXG4gICAgICAgIHJlc3RhdXJhbnQudmFsaWRhdGUoZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAvL2Vyci5lcnJvcnMucHJvcGVydHluYW1lXG4gICAgICAgICAgICBcbiAgICAgICAgICAgLy8gZXhwZWN0KGVycikudG8uYmUubnVsbDtcbiAgICAgICAgICAgICBleHBlY3QoZXJyLmVycm9ycykudG8uZXhpc3Q7IC8vIHByb3BlcnR5IG5hbWUgaXMgbm90IHdvcmtpbmdcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cblxuaXQoJ3Nob3VsZCBjYWxsIGJhY2sgd2l0aCB0cnVlIHdoZW4gcmVwb3N0IGV4aXN0cycsIHRlc3QoZnVuY3Rpb24oZG9uZSkge1xuICAgIHZhciByZXNwb25zZU9iamVjdCA9IHsgbmFtZTogJ2ZvbycgfTtcbiAgICAgdGhpcy5zdHViKFJlc3RhdXJhbnQsICdmaW5kT25lJykueWllbGRzKG51bGwsIHJlc3BvbnNlT2JqZWN0KTtcbiAgXG4gICAgICBcbiAgICBSZXN0YXVyYW50LmZpbmRPbmUoe30sIGZ1bmN0aW9uKGVyciwgcmVzdWx0KXtcbiAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KVxuICAgICAgICBleHBlY3QocmVzdWx0KS50by5oYXZlLnByb3BlcnR5KCduYW1lJyk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC5uYW1lKS50by5lcXVhbCgnZm9vJyk7XG4gXG5cblxuICAgICAgICBkb25lKCk7XG4gICAgfSlcbn0pKTtcblxuXG5cbml0KCdzaG91bGQgY2FsbCBtb2NrIHRlc3QnLCAgZnVuY3Rpb24oZG9uZSkge1xuICAgIHZhciByZXNwb25zZU9iamVjdCA9IHsgbmFtZTogJ2ZvbycgfTtcbiAgIFxuXG4gICBjb25zdCBmaW5kT25lU3R1YiA9IHNpbm9uLnN0dWIoUmVzdGF1cmFudCwgXCJmaW5kT25lXCIpLnlpZWxkcyhudWxsLCByZXNwb25zZU9iamVjdCk7XG5cbiAgICBSZXN0YXVyYW50LmZpbmRPbmUoe30sIGZ1bmN0aW9uKGVyciwgcmVzdWx0KXtcbiAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KVxuICAgICAgICBleHBlY3QocmVzdWx0KS50by5oYXZlLnByb3BlcnR5KCduYW1lJyk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC5uYW1lKS50by5lcXVhbCgnZm9vJyk7XG5cbiAgICAgICAgLy8gdG8gcmVsZWFzZSB0aGUgc3R1ZmZcbiAgICAgICAgZmluZE9uZVN0dWIucmVzdG9yZSgpO1xuXG4gICAgICAgIGRvbmUoKTtcbiAgICB9KVxufSk7XG5cblxuaXQoJ3Nob3VsZCBjYWxsIHNlcnZpY2Ugd2l0aCBnZXRSZXN0YXVyYW50IHdpdGggaWQnLCAgZnVuY3Rpb24oZG9uZSkge1xuICAgIHZhciByZXNwb25zZU9iamVjdCA9IHsgaWQ6ICcxMjM0NScsIG5hbWU6ICdmb28nIH07XG4gICBcblxuICAgY29uc3QgZmluZEJ5SWRTdHViID0gc2lub24uc3R1YihSZXN0YXVyYW50LCBcImZpbmRCeUlkXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAudXNpbmdQcm9taXNlKGJsdWViaXJkLlByb21pc2UpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVzb2x2ZXMocmVzcG9uc2VPYmplY3QpO1xuICAgICBnZXRSZXN0YXVyYW50KCcxMjM0NScpXG4gICAgLnRoZW4oIHJlc3VsdCA9PiB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmhhdmUucHJvcGVydHkoJ25hbWUnKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5uYW1lKS50by5lcXVhbCgnZm9vJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuaWQpLnRvLmVxdWFsKCcxMjM0NScpO1xuXG4gICAgICAgIHJlc3VsdC5pZC5zaG91bGQuZXF1YWwoJzEyMzQ1Jyk7XG4gICAgICAgIFxuXG4gICAgICAgIC8vIHRvIHJlbGVhc2UgdGhlIHN0dWZmXG4gICAgICAgIGZpbmRCeUlkU3R1Yi5yZXN0b3JlKCk7XG5cbiAgICAgICAgZG9uZSgpO1xuICAgIH0pIFxuIFxufSk7XG5cblxuXG59KTtcbiBcblxuXG5cbn0pOyJdfQ==